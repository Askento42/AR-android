<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seven — 3D-меню с AR</title>
  <meta name="description" content="Интерактивное меню ресторана Seven с 3D/AR моделями блюд." />

  <!-- model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    /* —— Seven theme ———————————————————————————— */
    :root{
      /* тёплая бежево-кофейная гамма */
      --bg:#d9cfbf;            /* фон страницы (как на скринах) */
      --card:#f4efe7;          /* карточки/контейнеры */
      --surface:#ffffff;       /* светлые внутренние блоки */
      --text:#1c1b1a;          /* основной текст */
      --muted:#6b665f;         /* вторичный текст */
      --border:#e3dacc;        /* светлая граница */
      --shadow:0 12px 40px rgba(59,45,33,.12);
      --radius:18px;
      --radius-sm:14px;
      --accent:#2a2a2a;        /* акцентные кнопки (чёрный) */
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);
      font-family: Inter, ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial}
    img{display:block;max-width:100%}
    a{color:inherit;text-decoration:none}

    .container{max-width:1280px;margin:0 auto;padding:24px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .brand{display:flex;gap:12px;align-items:center}
    .badge{width:42px;height:42px;border-radius:12px;background:#1a1a1a;color:#fff;display:grid;place-items:center;font-weight:800}

    .btn{padding:10px 16px;border-radius:12px;border:1px solid var(--border);background:var(--surface);cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .btn.ghost{background:transparent}

    /* — главная: плитка категорий — */
    #home{}
    .hero{display:flex;justify-content:space-between;align-items:flex-end;margin:8px 0 20px}
    .hero h1{margin:0;font-size:28px;letter-spacing:.5px}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(5,minmax(0,1fr))}
    @media (max-width:1100px){ .grid{grid-template-columns:repeat(4,1fr)} }
    @media (max-width:880px) { .grid{grid-template-columns:repeat(3,1fr)} }
    @media (max-width:680px) { .grid{grid-template-columns:repeat(2,1fr)} }
    .tile{
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
      padding:16px; min-height:120px; cursor:pointer; display:flex; flex-direction:column; gap:10px;
      transition:.15s ease; box-shadow:var(--shadow)
    }
    .tile:hover{transform:translateY(-2px)}
    .tile .name{font-weight:800; letter-spacing:.3px}
    .tile .meta{color:var(--muted); font-size:13px}
    .chip{align-self:flex-start; border-radius:999px; padding:6px 10px; font-size:12px;
      border:1px dashed #cbbda9; background:#efe6d9; color:#2b2117}

    /* — экран категории — */
    #menu{display:none}
    .topbar{display:flex;align-items:center;gap:12px;margin-bottom:16px}
    .where{font-weight:900;letter-spacing:.4px}
    .counter{margin-left:auto;color:var(--muted);font-weight:600}

    .layout{display:grid;grid-template-columns:420px 1fr;gap:22px}
    @media (max-width:980px){ .layout{grid-template-columns:1fr} }

    .list{display:grid;gap:12px}
    .item{
      display:grid;grid-template-columns:68px 1fr;gap:12px;align-items:center;
      padding:12px;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--surface);cursor:pointer;
      transition:.15s ease
    }
    .item:hover{transform:translateY(-1px)}
    .thumb{
      width:68px;height:68px;border-radius:14px;background:linear-gradient(135deg,#efe6db,#faf7f2);
      display:grid;place-items:center;font-weight:900;font-size:20px;color:#463e34;border:1px solid var(--border)
    }
    .meta h3{margin:0 0 4px 0;font-size:17px}
    .meta .sub{font-size:13px;color:var(--muted)}

    .pad{padding:14px;border:1px solid var(--border);border-radius:var(--radius);background:var(--surface);box-shadow:var(--shadow)}
    .viewer{border:1px solid var(--border);border-radius:var(--radius);background:var(--card);padding:10px;min-height:380px;display:grid;align-items:center}
    .titlebar{display:flex;justify-content:space-between;align-items:baseline;margin-top:14px}
    .price{font-weight:900}
    .controls{display:flex;gap:10px;margin-top:12px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand"><div class="badge">7</div><div style="font-weight:900">Seven — 3D-меню с AR</div></div>
      <a class="btn" href="tel:+996555000777">Забронировать</a>
    </header>

    <!-- Главная: категории -->
    <section id="home">
      <div class="hero">
        <h1>Меню Seven</h1>
        <button id="showAll" class="btn ghost">Показать все блюда</button>
      </div>
      <div id="catsGrid" class="grid"></div>
    </section>

    <!-- Экран категории -->
    <section id="menu">
      <div class="topbar">
        <button id="backBtn" class="btn">← К категориям</button>
        <div id="where" class="where"></div>
        <div id="counter" class="counter"></div>
        <a class="btn primary" href="tel:+996555000777">Позвонить</a>
      </div>

      <div class="layout">
        <div class="list" id="list"></div>
        <div class="pad">
          <div class="viewer" id="viewer">
            <div style="text-align:center;color:#9a938a">Выберите блюдо слева</div>
          </div>
          <div class="titlebar">
            <h2 id="vt">—</h2>
            <div class="price" id="vp">—</div>
          </div>
          <div id="vd" style="color:#7b746c;margin-top:6px">—</div>
          <div class="controls">
            <a id="glb" class="btn" style="display:none" target="_blank">GLB</a>
            <a id="usdz" class="btn" style="display:none" target="_blank">USDZ</a>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    const $ = s => document.querySelector(s);
    const STATE = { data:null, cat:null, active:null };

    const money = (n,c)=>{
      if(n==null) return '—';
      const map={"сом":"KGS","сомы":"KGS","kgs":"KGS"};
      const code = map[(c||'').toLowerCase()] || c || 'KGS';
      return new Intl.NumberFormat('ru-RU').format(n) + ' ' + code;
    };

    async function load(){
      const r = await fetch('./data/menu.json?_=' + Date.now());
      const raw = await r.json();
      STATE.data = { cats: raw.categories || [], items: raw.items || [] };
      bind();
      renderHome();
    }

    function bind(){
      $('#backBtn').onclick = showHome;
      $('#showAll').onclick = ()=>{ STATE.cat='Все'; showMenu(); renderList(); };
    }

    function showHome(){ $('#menu').style.display='none'; $('#home').style.display='block'; window.scrollTo({top:0,behavior:'smooth'}); }
    function showMenu(){
      $('#home').style.display='none'; $('#menu').style.display='block';
      $('#where').textContent = STATE.cat==='Все' ? 'Все блюда' : STATE.cat || 'Меню';
      $('#counter').textContent = `Категории: ${STATE.data.cats.length} • Блюда: ${STATE.data.items.length}`;
      window.scrollTo({top:0,behavior:'smooth'});
    }

    function renderHome(){
      const grid = $('#catsGrid'); grid.innerHTML = '';
      const counts = Object.fromEntries(STATE.data.cats.map(c=>[c,0]));
      for(const it of STATE.data.items){ if(counts[it.category]!=null) counts[it.category]++; }
      STATE.data.cats.forEach(cat=>{
        const el=document.createElement('div'); el.className='tile';
        el.innerHTML = `<div class="chip">${counts[cat]} поз.</div><div class="name">${cat}</div><div class="meta">Открыть раздел</div>`;
        el.onclick=()=>{ STATE.cat=cat; showMenu(); renderList(); };
        grid.appendChild(el);
      });
    }

    function thumbLetter(title){
      const el=document.createElement('div'); el.className='thumb';
      el.textContent = (title||'?').trim()[0]?.toUpperCase() || '?';
      return el;
    }

    function renderList(){
      const root=$('#list'); root.innerHTML='';
      const list = STATE.data.items.filter(x => (STATE.cat==='Все' || !STATE.cat) ? true : x.category===STATE.cat);
      list.forEach(x=>{
        const el=document.createElement('div'); el.className='item';
        const t=thumbLetter(x.title);
        const m=document.createElement('div'); m.className='meta';
        m.innerHTML=`<h3>${x.title}</h3><div class="sub">${(x.note?x.note+' • ':'')}${(x.grams||'').trim()}${x.price!=null?' • '+money(x.price,x.currency):''}</div>`;
        el.appendChild(t); el.appendChild(m);
        el.onclick=()=>openItem(x);
        root.appendChild(el);
      });
      if(list[0]) openItem(list[0]);
    }

    function openItem(x){
      STATE.active=x;
      $('#vt').textContent=x.title;
      $('#vp').textContent=x.price!=null?money(x.price,x.currency):'—';
      $('#vd').textContent = x.desc || x.note || '';
      const wrap=$('#viewer');

      if(x.model?.glb && x.model?.usdz){
        wrap.innerHTML = `
          <model-viewer src="${x.model.glb}" ios-src="${x.model.usdz}" ar
            ar-modes="webxr scene-viewer quick-look" camera-controls auto-rotate
            shadow-intensity="1" exposure="1.08"
            style="width:100%;height:480px;background:var(--card);border-radius:18px"></model-viewer>`;
        $('#glb').style.display='inline-block'; $('#glb').href=x.model.glb;
        $('#usdz').style.display='inline-block'; $('#usdz').href=x.model.usdz;
      } else {
        wrap.innerHTML = `<div style="text-align:center;color:#9a938a;padding:70px 0;">3D/AR появится позже</div>`;
        $('#glb').style.display='none'; $('#usdz').style.display='none';
      }
    }

    load();
  </script>
</body>
</html>
