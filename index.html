<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seven — 3D‑меню с AR</title>
  <meta name="description" content="Интерактивное меню ресторана Seven с 3D/AR моделями блюд." />
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    :root { --bg:#f6f2ed; --card:#ffffff; --text:#1b1b1b; --muted:#6b7280; --border:#e5e7eb; --accent:#7a2dff; --radius:16px; }
    *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .container{max-width:1280px;margin:0 auto;padding:24px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .logo{display:flex;align-items:center;gap:12px;font-weight:800}
    .logo-badge{width:40px;height:40px;border-radius:12px;background:#1b1b1b;color:#fff;display:grid;place-items:center}
    .filters{display:flex;gap:8px;overflow-x:auto;padding:8px 0 16px}
    .chip{padding:8px 14px;border:1px solid var(--border);background:var(--card);border-radius:999px;cursor:pointer;white-space:nowrap}
    .chip.active{border-color:#1b1b1b;color:#1b1b1b}
    .layout{display:grid;grid-template-columns:380px 1fr;gap:20px}
    @media (max-width:980px){ .layout{grid-template-columns:1fr} }
    .list{display:grid;gap:12px}
    .item{display:grid;grid-template-columns:56px 1fr;gap:12px;align-items:center;padding:10px;border:1px solid var(--border);border-radius:12px;background:var(--card);cursor:pointer}
    .thumb, .thumb-ph{width:56px;height:56px;border-radius:12px;display:grid;place-items:center;font-weight:800;font-size:18px}
    .thumb-ph{background:linear-gradient(135deg,#e2e8f0,#f8fafc);color:#475569}
    .meta h3{margin:0 0 4px 0;font-size:16px}
    .meta .sub{font-size:13px;color:var(--muted)}
    .viewer{border:1px solid var(--border);border-radius:16px;background:var(--card);padding:8px;min-height:360px;display:grid;align-items:center}
    .pad{padding:12px;border:1px solid var(--border);border-radius:16px;background:var(--card)}
    .titlebar{display:flex;justify-content:space-between;align-items:baseline;margin-top:12px}
    .price{font-weight:700}
    .controls{display:flex;gap:8px;margin-top:12px}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:var(--card);cursor:pointer}
    .btn.primary{background:#1b1b1b;color:#fff;border-color:#1b1b1b}
    .counter{color:#6b7280;font-weight:700}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo"><div class="logo-badge">7</div><div>Seven — 3D‑меню с AR</div></div>
      <div id="counter" class="counter">Загрузка…</div>
      <a class="btn" href="tel:+996555000777">Забронировать</a>
    </header>

    <div id="filters" class="filters"></div>

    <div class="layout">
      <div class="list" id="list"></div>
      <div class="pad">
        <div class="viewer" id="viewer">
          <div style="text-align:center;color:#9ca3af">Выберите блюдо слева</div>
        </div>
        <div class="titlebar">
          <h2 id="vt">—</h2>
          <div class="price" id="vp">—</div>
        </div>
        <div id="vd" style="color:#6b7280;margin-top:6px">—</div>
        <div class="controls">
          <a id="glb" class="btn" style="display:none" target="_blank">GLB</a>
          <a id="usdz" class="btn" style="display:none" target="_blank">USDZ</a>
          <button id="call" class="btn primary" onclick="location.href='tel:+996555000777'">Позвонить</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const STATE = { data:null, cat:'Все', active:null };

    function money(n, c){ if(n==null) return '—'; const map={ "сом":"KGS","kgs":"KGS","сомы":"KGS" }; const code=(map[(c||'').toLowerCase()]||c||"KGS"); return new Intl.NumberFormat('ru-RU').format(n)+' '+code; }

    async function load(){
      const url = './data/menu.json?_=' + Date.now();
      const r = await fetch(url);
      const raw = await r.json();

      const cats = (raw.categories || []).slice();
      const items = raw.items || [];

      STATE.data = { cats, items };
      document.getElementById('counter').textContent = `Категории: ${cats.length} • Блюда: ${items.length}`;
      renderFilters(); renderList();
    }

    function renderFilters(){
      const root = document.getElementById('filters'); root.innerHTML=''; const all=['Все', ...STATE.data.cats];
      all.forEach(cat=>{ const b=document.createElement('button'); b.className='chip'+(STATE.cat===cat?' active':''); b.textContent=cat; b.onclick=()=>{ STATE.cat=cat; renderList(); }; root.appendChild(b); });
    }

    function createThumb(title){
      const ph = document.createElement('div');
      ph.className = 'thumb-ph';
      ph.textContent = (title||'?').trim()[0] || '?';
      return ph;
    }

    function renderList(){
      const root=document.getElementById('list'); root.innerHTML='';
      const items = STATE.data.items.filter(x => STATE.cat==='Все' || x.category===STATE.cat);
      items.forEach(x=>{
        const el=document.createElement('div'); el.className='item';
        const thumb = createThumb(x.title);
        const meta = document.createElement('div'); meta.className='meta';
        meta.innerHTML = `<h3>${x.title}</h3><div class="sub">${(x.grams||'').trim()} ${x.price!=null?' • '+money(x.price, x.currency):''}</div>`;
        el.appendChild(thumb); el.appendChild(meta);
        el.onclick=()=>openItem(x);
        root.appendChild(el);
      });
      if(items[0]) openItem(items[0]);
    }

    function openItem(x){
      STATE.active=x; document.getElementById('vt').textContent=x.title; document.getElementById('vp').textContent=x.price!=null?money(x.price,x.currency):'—'; document.getElementById('vd').textContent=x.desc||'';
      const wrap=document.getElementById('viewer');
      if(x.model&&x.model.glb&&x.model.usdz){
        wrap.innerHTML = `<model-viewer src="${x.model.glb}" ios-src="${x.model.usdz}" ar ar-modes="webxr scene-viewer quick-look" camera-controls auto-rotate shadow-intensity="1" exposure="1.1" style="width:100%;height:460px;background:#f6f2ed;border-radius:12px"></model-viewer>`;
        const glb=document.getElementById('glb'); glb.style.display='inline-block'; glb.href=x.model.glb;
        const usdz=document.getElementById('usdz'); usdz.style.display='inline-block'; usdz.href=x.model.usdz;
      } else {
        wrap.innerHTML = `<div style="text-align:center;color:#9ca3af;padding:60px 0;">3D/AR и фото появятся позже</div>`;
        document.getElementById('glb').style.display='none';
        document.getElementById('usdz').style.display='none';
      }
    }

    load();
  </script>
</body>
</html>
